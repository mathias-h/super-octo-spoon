<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Djursland Landboforening</title>
    <style>
        @media screen and (max-width: 991px) {
            #navbar-statistics {
                display: none;
            }
        }
        html, body {
            min-width: 1190px;
        }
        .sortable {
            cursor: pointer;
        }
        thead tr th {
            vertical-align: middle !important;
        }

        .navbar {
            padding-right: 12px;
            padding-left: 4px;
        }
        .arrow-asc {
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 7px solid black;
            display: inline-block;
            margin-left: 5px;
        }
        .arrow-desc {
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-top: 7px solid black;
            display: inline-block;
            margin-left: 5px;
        }
        td[align=center] {
            vertical-align: middle !important;
        }
        .form-control:valid {
            border-color: #ced4da !important;
        }
        .form-control:valid:focus {
            border-color: #80bdff !important;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25) !important;
        }
        .bubble {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        #navbarSupportedContent a {
            color: lightgray;
        }
        #navbarSupportedContent span {
            color: lightgray;
        }
        .fase1 {
            background: #EF5350;
        }
        .fase2 {
            background: #3F51B5;
        }
        .fase3 {
            background: #D2E84E;
        }

        /* Farveskema 0.1: http://paletton.com/#uid=b00244c0klit+gCAGj5vTntspqGrt */
    </style>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <script src="https://momentjs.com/downloads/moment.min.js"></script>
    <script src="/createOrderModal.js"></script>
    <script src="/editOrderModal.js"></script>
    <script src="/createUser.js"></script>
    <script src="/createSeason.js"></script>
    <script src="/editUser.js"></script>
    <script src="/dynamic.js"></script>

    <script>
        onload = () => {
//                $("#season").val(location.search.substring(8,13))
//                $("#season").on("change", function (){
//                    location.search = "season=" + $("#season").val()
//                })

            $(".sortable").click(function () {
                var id = $(this).attr("id");
                var ls = location.search;
                var order = (ls.indexOf("order=asc") !== -1) ? "&order=desc" : "&order=asc";
                if (ls.length === 0 || (ls.indexOf("sortBy") !== -1 && ls.indexOf("query") === -1)) {
                    location.search = "sortBy=" + id + order;
                }
                else if (ls.indexOf("query") !== -1 && ls.indexOf("sortBy") === -1) {
                    location.search += "&sortBy=" + id + order;
                } else {
                    location.search = location.search.substring(0, location.search.indexOf("&")) + "&sortBy=" + id + order;
                }
            })
            if (location.search.indexOf("sortBy") !== -1) {
                $("#date")[0].removeChild($("#date")[0].children[0])
                var url = new URL(location.href)
                var sortBy = url.searchParams.get("sortBy").toString()
                var orderBy = url.searchParams.get("order").toString()
                if (orderBy == "asc") {
                    $("#" + sortBy).append("<div class='arrow-asc'></div>")
                } else {
                    $("#" + sortBy).append("<div class='arrow-desc'></div>")
                }
            }
        }
    </script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
            style="cursor: pointer">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#createOrderModal">Opret
                    Jordprøvebestilling</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#adminModal">Administration</a>
            </li>
            <li class="nav-item">
                <select id="season" class="btn btn-sm mt-1">
                    <!-- TODO check implementation -->
                    {{#each seasons}}
                        <option value="{{this.id}}">Sæson {{this.season}}</option>
                    {{/each}}
                </select>
            </li>
            <li>
                <span id="navbar-statistics" style="position: absolute; left: 50%; transform: translateX(-50%);"
                      class="navbar-text justify-content-center">Prøver Udtaget: {{totalTaken}}
                    / {{totalSamples}}</span>
            </li>
        </ul>
    </div>
    <form id="search" class="form-inline my-4 my-sm-0">
        <div class="input-group">
            <input class="form-control" type="search" name="query" placeholder="Søg..." aria-label="Search"
                   value="{{query}}">
            <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit" style="cursor: pointer;">
                        <img src="/search.svg" alt="search icon">
                    </button>
                </span>
        </div>
    </form>
</nav>
<div id="contentData">
    <table class="table table-striped table-sm text-truncate">
        <thead>
        <tr>
            <th class="sortable" id="fase">Fase</th>
            <th class="sortable" id="consultant" data-toggle="tooltip" title="Konsulent, som håndterer denne ordre">
                Kon.
            </th>
            <th class="sortable" id="date" data-toggle="tooltip" title="Dato for oprettelse">Opr.d.
                <div class="arrow-desc"></div>
            </th>
            <th class="sortable" id="landline" data-toggle="tooltip" title="Kundens fastnet nummer">Fasnet</th>
            <th class="sortable" id="mobile" data-toggle="tooltip" title="Kundens mobiltelefon nummer">Mobil</th>
            <th class="sortable" id="name" data-toggle="tooltip" title="Fulde navn på kunden">Navn</th>
            <th class="sortable" id="address" data-toggle="tooltip" title="Adresse på gården">Adr.</th>
            <th data-toggle="tooltip" title="Kommentar og andet">Komm.</th>
            <th data-toggle="tooltip" title="Prøve tæthed">Pr.tth.</th>
            <th class="sortable" id="area" data-toggle="tooltip" title="Areal, for prøverne">Areal</th>
            <th class="sortable" id="sameAsLast" data-toggle="tooltip" title="Samme plan, som sidst">Spss.</th>
            <th class="sortable" id="self" data-toggle="tooltip" title="Kunden tager selv prøverne">Selvu.</th>
        </tr>
        </thead>
        <tbody>
        {{#each orders}}
            <tr class="order" data-order-id="{{_id}}">
                <td align="center">
                    <div class="bubble fase{{fase}}"></div>
                </td>
                <td>
                    {{consultant.username}}
                </td>
                <td>
                    {{signedDate}}
                </td>
                <td>
                    {{landlineNumber}}
                </td>
                <td>
                    {{phoneNumber}}
                </td>
                <td>
                    {{name}}
                </td>
                <td>
                    {{farmName}}, {{address.street}}, {{address.zip}} {{address.city}}
                </td>
                <td>
                    {{comment}}
                </td>
                <td>
                    {{#if sampleDensity}}
                        1/{{sampleDensity}} ha
                    {{else}}
                        ikke sat
                    {{/if}}
                </td>
                <td>{{area}} ha</td>
                <td align="center">
                    {{#if samePlanAsLast}}
                        <img src="/check.svg" alt="flueben"/>
                    {{/if}}
                </td>
                <td align="center">
                    {{#if takeOwnSamples}}
                        <img src="/check.svg" alt="flueben"/>
                    {{/if}}
                </td>
            </tr>
        {{/each}}
        </tbody>
    </table>
</div>

{{> createOrderModal}}
{{> editOrderModal}}
{{> adminModal}}

</body>
</html>